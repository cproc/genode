qtdeclarative_genode.patch

From: Christian Prochaska <christian.prochaska@genode-labs.com>


---
 qtdeclarative/src/qml/jsruntime/qv4engine.cpp |    4 ++++
 qtdeclarative/src/qml/jsruntime/qv4global_p.h |    2 +-
 qtdeclarative/src/qml/qml/qqmlimport.cpp      |    3 +++
 3 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/qtdeclarative/src/qml/jsruntime/qv4engine.cpp b/qtdeclarative/src/qml/jsruntime/qv4engine.cpp
index 0ed0df89a9..b38e145383 100644
--- a/qtdeclarative/src/qml/jsruntime/qv4engine.cpp
+++ b/qtdeclarative/src/qml/jsruntime/qv4engine.cpp
@@ -95,6 +95,10 @@
 #include <valgrind/memcheck.h>
 #endif
 
+#if defined(Q_OS_GENODE)
+#include <base/thread.h>
+#endif
+
 QT_BEGIN_NAMESPACE
 
 using namespace QV4;
diff --git a/qtdeclarative/src/qml/jsruntime/qv4global_p.h b/qtdeclarative/src/qml/jsruntime/qv4global_p.h
index 1fa4bae049..ef8f88b08b 100644
--- a/qtdeclarative/src/qml/jsruntime/qv4global_p.h
+++ b/qtdeclarative/src/qml/jsruntime/qv4global_p.h
@@ -115,7 +115,7 @@ inline double trunc(double d) { return d > 0 ? floor(d) : ceil(d); }
 
 // Black list some platforms
 #if defined(V4_ENABLE_JIT)
-#if defined(Q_OS_IOS) || defined(Q_OS_TVOS)
+#if defined(Q_OS_IOS) || defined(Q_OS_TVOS) || defined(Q_OS_GENODE)
 #    undef V4_ENABLE_JIT
 #endif
 #endif
diff --git a/qtdeclarative/src/qml/qml/qqmlimport.cpp b/qtdeclarative/src/qml/qml/qqmlimport.cpp
index 80ebab5ca3..28f9bc7ed2 100644
--- a/qtdeclarative/src/qml/qml/qqmlimport.cpp
+++ b/qtdeclarative/src/qml/qml/qqmlimport.cpp
@@ -1878,6 +1878,9 @@ QString QQmlImportDatabase::resolvePlugin(QQmlTypeLoader *typeLoader,
         QLatin1String(".so"),
         QLatin1String(".bundle")
     };
+#elif defined(Q_OS_GENODE)
+    static const QString prefix = QLatin1String("qt5_");
+    static const QStringList suffixes = { QLatin1String(".lib.so") };
 # else  // Unix
     static const QString prefix = QLatin1String("lib");
     static const QStringList suffixes = { QLatin1String(".so") };
