qt5_configuration.patch

From: Christian Prochaska <christian.prochaska@genode-labs.com>


---
 qtbase/configure                           |   98 +++---
 qtbase/mkspecs/genode-g++/qmake.conf       |   10 +
 qtbase/mkspecs/genode-g++/qplatformdefs.h  |   87 ++++++
 qtbase/src/corelib/global/qconfig-genode.h |  426 ++++++++++++++++++++++++++++
 qtdeclarative/tools/tools.pro              |    4 
 5 files changed, 573 insertions(+), 52 deletions(-)
 create mode 100644 qtbase/mkspecs/genode-g++/qmake.conf
 create mode 100644 qtbase/mkspecs/genode-g++/qplatformdefs.h
 create mode 100644 qtbase/src/corelib/global/qconfig-genode.h

diff --git a/qtbase/configure b/qtbase/configure
index ba94d08..b11fb4c 100755
--- a/qtbase/configure
+++ b/qtbase/configure
@@ -636,10 +636,10 @@ CFG_MTDEV=auto
 CFG_JOURNALD=no
 CFG_SYSLOG=no
 CFG_SQLITE=qt
-CFG_GIF=auto
+CFG_GIF=yes
 CFG_PNG=yes
 CFG_LIBPNG=auto
-CFG_JPEG=auto
+CFG_JPEG=yes
 CFG_LIBJPEG=auto
 CFG_XCURSOR=runtime
 CFG_XRANDR=runtime
@@ -748,7 +748,7 @@ CFG_GETADDRINFO=auto
 CFG_IPV6IFNAME=auto
 CFG_GETIFADDRS=auto
 CFG_INOTIFY=auto
-CFG_EVENTFD=auto
+CFG_EVENTFD=no
 CFG_CLOEXEC=no
 CFG_POLL=auto
 CFG_RPATH=yes
@@ -5418,16 +5418,16 @@ elif [ "$CFG_OPENGL" = "es2" ]; then
         echo " ${XQMAKESPEC}."
         exit 1
     fi
-elif [ "$CFG_OPENGL" = "desktop" ]; then
-    # Desktop OpenGL support
-    compileTestWithPkgConfig gl unix/opengldesktop "OpenGL" OPENGL
-    if [ $? != "0" ]; then
-        echo "The OpenGL functionality test failed!"
-        echo " You might need to modify the include and library search paths by editing"
-        echo " QMAKE_INCDIR_OPENGL, QMAKE_LIBDIR_OPENGL and QMAKE_LIBS_OPENGL in"
-        echo " ${XQMAKESPEC}."
-        exit 1
-    fi
+#elif [ "$CFG_OPENGL" = "desktop" ]; then
+#    # Desktop OpenGL support
+#    compileTestWithPkgConfig gl unix/opengldesktop "OpenGL" OPENGL
+#    if [ $? != "0" ]; then
+#        echo "The OpenGL functionality test failed!"
+#        echo " You might need to modify the include and library search paths by editing"
+#        echo " QMAKE_INCDIR_OPENGL, QMAKE_LIBDIR_OPENGL and QMAKE_LIBS_OPENGL in"
+#        echo " ${XQMAKESPEC}."
+#        exit 1
+#    fi
 fi
 
 # If OpenGL ES 2.0 is enabled, check for 3.0 and higher. This is used to allow
@@ -5840,39 +5840,39 @@ else
 fi
 
 # EGL Support
-if [ "$CFG_EGL" != "no" ]; then
-    if [ "$CFG_EGL" = "yes" ] && [ "$CFG_OPENGL" = "no" ]; then
-        echo "EGL support was requested but OpenGL support is disabled."
-        echo "Either disable EGL support or enable OpenGL support."
-        exit 101
-    fi
-
-    if [ -n "$PKG_CONFIG" ] && $PKG_CONFIG --exists egl 2>/dev/null; then
-        QMAKE_INCDIR_EGL=`$PKG_CONFIG --cflags-only-I egl 2>/dev/null | sed -e 's,^-I,,g' -e 's, -I, ,g'`
-        QMAKE_LIBS_EGL=`$PKG_CONFIG --libs egl 2>/dev/null`
-        QMAKE_CFLAGS_EGL=`$PKG_CONFIG --cflags egl 2>/dev/null`
-        QMakeVar set QMAKE_INCDIR_EGL "$QMAKE_INCDIR_EGL"
-        QMakeVar set QMAKE_LIBS_EGL "$QMAKE_LIBS_EGL"
-        QMakeVar set QMAKE_CFLAGS_EGL "`echo " $QMAKE_CFLAGS_EGL " | sed -e 's, -I[^ ]* , ,g;s,^ ,,;s, $,,'`"
-    fi       # detect EGL support
-    if compileTest qpa/egl "EGL" $QMAKE_CFLAGS_EGL $QMAKE_LIBS_EGL; then
-        CFG_EGL=yes
-        if compileTest qpa/egl-x11 "EGL-X11" $QMAKE_CFLAGS_EGL $QMAKE_LIBS_EGL; then
-            CFG_EGL_X=yes
-        else
-            CFG_EGL_X=no
-        fi
-    elif [ "$CFG_EGL" = "yes" ]; then
-        echo " The EGL functionality test failed; EGL is required by some QPA plugins to manage contexts & surfaces."
-        [ -z "$PKG_CONFIG" ] && echo " Use of pkg-config is not enabled, maybe you want to pass -pkg-config?"
-        echo " You might need to modify the include and library search paths by editing"
-        echo " QMAKE_INCDIR_EGL, QMAKE_LIBDIR_EGL and QMAKE_LIBS_EGL in ${XQMAKESPEC}."
-        exit 1
-    else
-        CFG_EGL=no
-        CFG_EGL_X=no
-    fi
-fi
+#if [ "$CFG_EGL" != "no" ]; then
+#    if [ "$CFG_EGL" = "yes" ] && [ "$CFG_OPENGL" = "no" ]; then
+#        echo "EGL support was requested but OpenGL support is disabled."
+#        echo "Either disable EGL support or enable OpenGL support."
+#        exit 101
+#    fi
+#
+#    if [ -n "$PKG_CONFIG" ] && $PKG_CONFIG --exists egl 2>/dev/null; then
+#        QMAKE_INCDIR_EGL=`$PKG_CONFIG --cflags-only-I egl 2>/dev/null | sed -e 's,^-I,,g' -e 's, -I, ,g'`
+#        QMAKE_LIBS_EGL=`$PKG_CONFIG --libs egl 2>/dev/null`
+#        QMAKE_CFLAGS_EGL=`$PKG_CONFIG --cflags egl 2>/dev/null`
+#        QMakeVar set QMAKE_INCDIR_EGL "$QMAKE_INCDIR_EGL"
+#        QMakeVar set QMAKE_LIBS_EGL "$QMAKE_LIBS_EGL"
+#        QMakeVar set QMAKE_CFLAGS_EGL "`echo " $QMAKE_CFLAGS_EGL " | sed -e 's, -I[^ ]* , ,g;s,^ ,,;s, $,,'`"
+#    fi       # detect EGL support
+#    if compileTest qpa/egl "EGL" $QMAKE_CFLAGS_EGL $QMAKE_LIBS_EGL; then
+#        CFG_EGL=yes
+#        if compileTest qpa/egl-x11 "EGL-X11" $QMAKE_CFLAGS_EGL $QMAKE_LIBS_EGL; then
+#            CFG_EGL_X=yes
+#        else
+#            CFG_EGL_X=no
+#        fi
+#    elif [ "$CFG_EGL" = "yes" ]; then
+#        echo " The EGL functionality test failed; EGL is required by some QPA plugins to manage contexts & surfaces."
+#        [ -z "$PKG_CONFIG" ] && echo " Use of pkg-config is not enabled, maybe you want to pass -pkg-config?"
+#        echo " You might need to modify the include and library search paths by editing"
+#        echo " QMAKE_INCDIR_EGL, QMAKE_LIBDIR_EGL and QMAKE_LIBS_EGL in ${XQMAKESPEC}."
+#        exit 1
+#    else
+#        CFG_EGL=no
+#        CFG_EGL_X=no
+#    fi
+#fi
 
 if [ "$CFG_EGLFS" != "no" ]; then
     if [ "$XPLATFORM_QNX" = "no" ] && [ "$CFG_OPENGL" != "no" ]; then
@@ -6170,9 +6170,9 @@ if [ "$CFG_GETIFADDRS" != "no" ]; then
 fi
 
 # find if the platform provides thread-safe CLOEXEC support
-if compileTest unix/cloexec "cloexec"; then
-    CFG_CLOEXEC=yes
-fi
+#if compileTest unix/cloexec "cloexec"; then
+#    CFG_CLOEXEC=yes
+#fi
 
 if compileTest unix/ppoll "ppoll"; then
     CFG_POLL="ppoll"
diff --git a/qtbase/mkspecs/genode-g++/qmake.conf b/qtbase/mkspecs/genode-g++/qmake.conf
new file mode 100644
index 0000000..734ae5c
--- /dev/null
+++ b/qtbase/mkspecs/genode-g++/qmake.conf
@@ -0,0 +1,10 @@
+#
+# qmake configuration for genode-g++
+#
+
+MAKEFILE_GENERATOR	= UNIX
+
+include(../common/unix.conf)
+include(../common/gcc-base-unix.conf)
+include(../common/g++-unix.conf)
+load(qt_config)
diff --git a/qtbase/mkspecs/genode-g++/qplatformdefs.h b/qtbase/mkspecs/genode-g++/qplatformdefs.h
new file mode 100644
index 0000000..5e5c341
--- /dev/null
+++ b/qtbase/mkspecs/genode-g++/qplatformdefs.h
@@ -0,0 +1,87 @@
+/****************************************************************************
+**
+** Copyright (C) 2016 The Qt Company Ltd.
+** Contact: https://www.qt.io/licensing/
+**
+** This file is part of the qmake spec of the Qt Toolkit.
+**
+** $QT_BEGIN_LICENSE:LGPL$
+** Commercial License Usage
+** Licensees holding valid commercial Qt licenses may use this file in
+** accordance with the commercial license agreement provided with the
+** Software or, alternatively, in accordance with the terms contained in
+** a written agreement between you and The Qt Company. For licensing terms
+** and conditions see https://www.qt.io/terms-conditions. For further
+** information use the contact form at https://www.qt.io/contact-us.
+**
+** GNU Lesser General Public License Usage
+** Alternatively, this file may be used under the terms of the GNU Lesser
+** General Public License version 3 as published by the Free Software
+** Foundation and appearing in the file LICENSE.LGPL3 included in the
+** packaging of this file. Please review the following information to
+** ensure the GNU Lesser General Public License version 3 requirements
+** will be met: https://www.gnu.org/licenses/lgpl-3.0.html.
+**
+** GNU General Public License Usage
+** Alternatively, this file may be used under the terms of the GNU
+** General Public License version 2.0 or (at your option) the GNU General
+** Public license version 3 or any later version approved by the KDE Free
+** Qt Foundation. The licenses are as published by the Free Software
+** Foundation and appearing in the file LICENSE.GPL2 and LICENSE.GPL3
+** included in the packaging of this file. Please review the following
+** information to ensure the GNU General Public License requirements will
+** be met: https://www.gnu.org/licenses/gpl-2.0.html and
+** https://www.gnu.org/licenses/gpl-3.0.html.
+**
+** $QT_END_LICENSE$
+**
+****************************************************************************/
+
+#ifndef QPLATFORMDEFS_H
+#define QPLATFORMDEFS_H
+
+// Get Qt defines/settings
+
+#include "qglobal.h"
+
+// Set any POSIX/XOPEN defines at the top of this file to turn on specific APIs
+
+#include <unistd.h>
+
+
+// We are hot - unistd.h should have turned on the specific APIs we requested
+
+
+#include <pthread.h>
+#include <dirent.h>
+#include <fcntl.h>
+#include <grp.h>
+#include <pwd.h>
+#include <signal.h>
+#include <dlfcn.h>
+
+#include <sys/param.h>
+#include <sys/types.h>
+#include <sys/ioctl.h>
+#include <sys/ipc.h>
+#include <sys/time.h>
+#ifndef Q_OS_GENODE
+#include <sys/shm.h>
+#endif
+#include <sys/socket.h>
+#include <sys/stat.h>
+#include <sys/wait.h>
+#include <netinet/in.h>
+#ifndef QT_NO_IPV6IFNAME
+#include <net/if.h>
+#endif
+
+#include "../common/posix/qplatformdefs.h"
+
+#undef QT_OPEN_LARGEFILE
+#define QT_OPEN_LARGEFILE 0
+
+#define QT_SNPRINTF		::snprintf
+#define QT_VSNPRINTF		::vsnprintf
+
+#endif // QPLATFORMDEFS_H
diff --git a/qtbase/src/corelib/global/qconfig-genode.h b/qtbase/src/corelib/global/qconfig-genode.h
new file mode 100644
index 0000000..56a0b73
--- /dev/null
+++ b/qtbase/src/corelib/global/qconfig-genode.h
@@ -0,0 +1,426 @@
+/* Data structures */
+//#ifndef QT_NO_TEXTDATE
+//#  define QT_NO_TEXTDATE
+//#endif
+//#ifndef QT_NO_DATESTRING
+//#  define QT_NO_DATESTRING
+//#endif
+
+/* Dialogs */
+//#ifndef QT_NO_COLORDIALOG
+//#  define QT_NO_COLORDIALOG
+//#endif
+//#ifndef QT_NO_ERRORMESSAGE
+//#  define QT_NO_ERRORMESSAGE
+//#endif
+//#ifndef QT_NO_FILEDIALOG
+//#  define QT_NO_FILEDIALOG
+//#endif
+//#ifndef QT_NO_FONTDIALOG
+//#  define QT_NO_FONTDIALOG
+//#endif
+//#ifndef QT_NO_INPUTDIALOG
+//#  define QT_NO_INPUTDIALOG
+//#endif
+//#ifndef QT_NO_MESSAGEBOX
+//#  define QT_NO_MESSAGEBOX
+//#endif
+#ifndef QT_NO_PRINTDIALOG
+#  define QT_NO_PRINTDIALOG
+#endif
+#ifndef QT_NO_PRINTPREVIEWDIALOG
+#  define QT_NO_PRINTPREVIEWDIALOG
+#endif
+//#ifndef QT_NO_PROGRESSDIALOG
+//#  define QT_NO_PROGRESSDIALOG
+//#endif
+//#ifndef QT_NO_WIZARD
+//#  define QT_NO_WIZARD
+//#endif
+
+/* File I/O */
+//#ifndef QT_NO_DOM
+//#  define QT_NO_DOM
+//#endif
+//#ifndef QT_NO_FILESYSTEMWATCHER
+//#  define QT_NO_FILESYSTEMWATCHER
+//#endif
+//#ifndef QT_NO_FILESYSTEMMODEL
+//#  define QT_NO_FILESYSTEMMODEL
+//#endif
+#ifndef QT_NO_PROCESS
+#  define QT_NO_PROCESS
+#endif
+//#ifndef QT_NO_TEMPORARYFILE
+//#  define QT_NO_TEMPORARYFILE
+//#endif
+//#ifndef QT_NO_SETTINGS
+//#  define QT_NO_SETTINGS
+//#endif
+//#ifndef QT_NO_LIBRARY
+//#  define QT_NO_LIBRARY
+//#endif
+
+/* Fonts */
+//#ifndef QT_NO_FREETYPE
+//#  define QT_NO_FREETYPE
+//#endif
+
+/* Images */
+//#ifndef QT_NO_IMAGEFORMATPLUGIN
+//#  define QT_NO_IMAGEFORMATPLUGIN
+//#endif
+//#ifndef QT_NO_IMAGEFORMAT_BMP
+//#  define QT_NO_IMAGEFORMAT_BMP
+//#endif
+//#ifndef QT_NO_IMAGEFORMAT_JPEG
+//#  define QT_NO_IMAGEFORMAT_JPEG
+//#endif
+//#ifndef QT_NO_IMAGEFORMAT_PNG
+//#  define QT_NO_IMAGEFORMAT_PNG
+//#endif
+//#ifndef QT_NO_IMAGEFORMAT_PPM
+//#  define QT_NO_IMAGEFORMAT_PPM
+//#endif
+//#ifndef QT_NO_IMAGEFORMAT_XBM
+//#  define QT_NO_IMAGEFORMAT_XBM
+//#endif
+//#ifndef QT_NO_IMAGEFORMAT_XPM
+//#  define QT_NO_IMAGEFORMAT_XPM
+//#endif
+//#ifndef QT_NO_IMAGE_HEURISTIC_MASK
+//#  define QT_NO_IMAGE_HEURISTIC_MASK
+//#endif
+//#ifndef QT_NO_MOVIE
+//#  define QT_NO_MOVIE
+//#endif
+
+/* Internationalization */
+//#ifndef QT_NO_BIG_CODECS
+//#  define QT_NO_BIG_CODECS
+//#endif
+//#ifndef QT_NO_TEXTCODEC
+//#  define QT_NO_TEXTCODEC
+//#endif
+//#ifndef QT_NO_CODECS
+//#  define QT_NO_CODECS
+//#endif
+//#ifndef QT_NO_TRANSLATION
+//#  define QT_NO_TRANSLATION
+//#endif
+
+/* ItemViews */
+//#ifndef QT_NO_ITEMVIEWS
+//#  define QT_NO_ITEMVIEWS
+//#endif
+//#ifndef QT_NO_DATAWIDGETMAPPER
+//#  define QT_NO_DATAWIDGETMAPPER
+//#endif
+//#ifndef QT_NO_DIRMODEL
+//#  define QT_NO_DIRMODEL
+//#endif
+//#ifndef QT_NO_LISTVIEW
+//#  define QT_NO_LISTVIEW
+//#endif
+//#ifndef QT_NO_COLUMNVIEW
+//#  define QT_NO_COLUMNVIEW
+//#endif
+//#ifndef QT_NO_PROXYMODEL
+//#  define QT_NO_PROXYMODEL
+//#endif
+//#ifndef QT_NO_SORTFILTERPROXYMODEL
+//#  define QT_NO_SORTFILTERPROXYMODEL
+//#endif
+//#ifndef QT_NO_STANDARDITEMMODEL
+//#  define QT_NO_STANDARDITEMMODEL
+//#endif
+//#ifndef QT_NO_STRINGLISTMODEL
+//#  define QT_NO_STRINGLISTMODEL
+//#endif
+//#ifndef QT_NO_TABLEVIEW
+//#  define QT_NO_TABLEVIEW
+//#endif
+//#ifndef QT_NO_TREEVIEW
+//#  define QT_NO_TREEVIEW
+//#endif
+
+/* Kernel */
+//#ifndef QT_NO_ACTION
+//#  define QT_NO_ACTION
+//#endif
+//#ifndef QT_NO_CLIPBOARD
+//#  define QT_NO_CLIPBOARD
+//#endif
+//#ifndef QT_NO_CSSPARSER
+//#  define QT_NO_CSSPARSER
+//#endif
+//#ifndef QT_NO_CURSOR
+//#  define QT_NO_CURSOR
+//#endif
+//#ifndef QT_NO_DRAGANDDROP
+//#  define QT_NO_DRAGANDDROP
+//#endif
+//#ifndef QT_NO_EFFECTS
+//#  define QT_NO_EFFECTS
+//#endif
+//#ifndef QT_NO_PROPERTIES
+//#  define QT_NO_PROPERTIES
+//#endif
+#ifndef QT_NO_SESSIONMANAGER
+#  define QT_NO_SESSIONMANAGER
+#endif
+#ifndef QT_NO_SHAREDMEMORY
+#  define QT_NO_SHAREDMEMORY
+#endif
+//#ifndef QT_NO_SHORTCUT
+//#  define QT_NO_SHORTCUT
+//#endif
+#ifndef QT_NO_SYSTEMSEMAPHORE
+#  define QT_NO_SYSTEMSEMAPHORE
+#endif
+//#ifndef QT_NO_TABLETEVENT
+//#  define QT_NO_TABLETEVENT
+//#endif
+//#ifndef QT_NO_TEXTHTMLPARSER
+//#  define QT_NO_TEXTHTMLPARSER
+//#endif
+#ifndef QT_NO_CONCURRENT
+#  define QT_NO_CONCURRENT
+#endif
+//#ifndef QT_NO_WHEELEVENT
+//#  define QT_NO_WHEELEVENT
+//#endif
+//#ifndef QT_NO_XMLSTREAM
+//#  define QT_NO_XMLSTREAM
+//#endif
+//#ifndef QT_NO_XMLSTREAMREADER
+//#  define QT_NO_XMLSTREAMREADER
+//#endif
+//#ifndef QT_NO_XMLSTREAMWRITER
+//#  define QT_NO_XMLSTREAMWRITER
+//#endif
+
+/* Networking */
+//#ifndef QT_NO_HTTP
+//#  define QT_NO_HTTP
+//#endif
+//#ifndef QT_NO_NETWORKPROXY
+//#  define QT_NO_NETWORKPROXY
+//#endif
+//#ifndef QT_NO_SOCKS5
+//#  define QT_NO_SOCKS5
+//#endif
+//#ifndef QT_NO_UDPSOCKET
+//#  define QT_NO_UDPSOCKET
+//#endif
+#ifndef QT_NO_FTP
+#  define QT_NO_FTP
+#endif
+
+/* Added for Genode */
+#ifndef QT_NO_NETWORKINTERFACE
+#  define QT_NO_NETWORKINTERFACE
+#endif
+
+/* Painting */
+//#ifndef QT_NO_COLORNAMES
+//#  define QT_NO_COLORNAMES
+//#endif
+//#ifndef QT_NO_PAINT_DEBUG
+//#  define QT_NO_PAINT_DEBUG
+//#endif
+//#ifndef QT_NO_PICTURE
+//#  define QT_NO_PICTURE
+//#endif
+#ifndef QT_NO_PRINTER
+#  define QT_NO_PRINTER
+#endif
+#ifndef QT_NO_CUPS
+#  define QT_NO_CUPS
+#endif
+
+/* Styles */
+//#ifndef QT_NO_STYLE_FUSION
+//#  define QT_NO_STYLE_FUSION
+//#endif
+//#ifndef QT_NO_STYLE_STYLESHEET
+//#  define QT_NO_STYLE_STYLESHEET
+//#endif
+//#ifndef QT_NO_STYLE_WINDOWSCE
+//#  define QT_NO_STYLE_WINDOWSCE
+//#endif
+//#ifndef QT_NO_STYLE_WINDOWSMOBILE
+//#  define QT_NO_STYLE_WINDOWSMOBILE
+//#endif
+//#ifndef QT_NO_STYLE_WINDOWSVISTA
+//#  define QT_NO_STYLE_WINDOWSVISTA
+//#endif
+//#ifndef QT_NO_STYLE_WINDOWSXP
+//#  define QT_NO_STYLE_WINDOWSXP
+//#endif
+
+/* Utilities */
+//#ifndef QT_NO_ACCESSIBILITY
+//#  define QT_NO_ACCESSIBILITY
+//#endif
+//#ifndef QT_NO_COMPLETER
+//#  define QT_NO_COMPLETER
+//#endif
+//#ifndef QT_NO_DESKTOPSERVICES
+//#  define QT_NO_DESKTOPSERVICES
+//#endif
+//#ifndef QT_NO_SYSTEMTRAYICON
+//#  define QT_NO_SYSTEMTRAYICON
+//#endif
+//#ifndef QT_NO_UNDOCOMMAND
+//#  define QT_NO_UNDOCOMMAND
+//#endif
+//#ifndef QT_NO_UNDOGROUP
+//#  define QT_NO_UNDOGROUP
+//#endif
+//#ifndef QT_NO_UNDOSTACK
+//#  define QT_NO_UNDOSTACK
+//#endif
+//#ifndef QT_NO_UNDOVIEW
+//#  define QT_NO_UNDOVIEW
+//#endif
+//#ifndef QT_NO_GESTURES
+//#  define QT_NO_GESTURES
+//#endif
+
+/* Widgets */
+//#ifndef QT_NO_GROUPBOX
+//#  define QT_NO_GROUPBOX
+//#endif
+//#ifndef QT_NO_BUTTONGROUP
+//#  define QT_NO_BUTTONGROUP
+//#endif
+//#ifndef QT_NO_LCDNUMBER
+//#  define QT_NO_LCDNUMBER
+//#endif
+//#ifndef QT_NO_LINEEDIT
+//#  define QT_NO_LINEEDIT
+//#endif
+//#ifndef QT_NO_COMBOBOX
+//#  define QT_NO_COMBOBOX
+//#endif
+//#ifndef QT_NO_FONTCOMBOBOX
+//#  define QT_NO_FONTCOMBOBOX
+//#endif
+//#ifndef QT_NO_SPINBOX
+//#  define QT_NO_SPINBOX
+//#endif
+//#ifndef QT_NO_CALENDARWIDGET
+//#  define QT_NO_CALENDARWIDGET
+//#endif
+//#ifndef QT_NO_DATETIMEEDIT
+//#  define QT_NO_DATETIMEEDIT
+//#endif
+//#ifndef QT_NO_LISTWIDGET
+//#  define QT_NO_LISTWIDGET
+//#endif
+//#ifndef QT_NO_MENU
+//#  define QT_NO_MENU
+//#endif
+//#ifndef QT_NO_CONTEXTMENU
+//#  define QT_NO_CONTEXTMENU
+//#endif
+//#ifndef QT_NO_MAINWINDOW
+//#  define QT_NO_MAINWINDOW
+//#endif
+//#ifndef QT_NO_DOCKWIDGET
+//#  define QT_NO_DOCKWIDGET
+//#endif
+//#ifndef QT_NO_TOOLBAR
+//#  define QT_NO_TOOLBAR
+//#endif
+//#ifndef QT_NO_MENUBAR
+//#  define QT_NO_MENUBAR
+//#endif
+//#ifndef QT_NO_PROGRESSBAR
+//#  define QT_NO_PROGRESSBAR
+//#endif
+//#ifndef QT_NO_RESIZEHANDLER
+//#  define QT_NO_RESIZEHANDLER
+//#endif
+//#ifndef QT_NO_RUBBERBAND
+//#  define QT_NO_RUBBERBAND
+//#endif
+//#ifndef QT_NO_SPLITTER
+//#  define QT_NO_SPLITTER
+//#endif
+//#ifndef QT_NO_SIZEGRIP
+//#  define QT_NO_SIZEGRIP
+//#endif
+//#ifndef QT_NO_SLIDER
+//#  define QT_NO_SLIDER
+//#endif
+//#ifndef QT_NO_DIAL
+//#  define QT_NO_DIAL
+//#endif
+//#ifndef QT_NO_SCROLLBAR
+//#  define QT_NO_SCROLLBAR
+//#endif
+//#ifndef QT_NO_SCROLLAREA
+//#  define QT_NO_SCROLLAREA
+//#endif
+//#ifndef QT_NO_GRAPHICSVIEW
+//#  define QT_NO_GRAPHICSVIEW
+//#endif
+//#ifndef QT_NO_PRINTPREVIEWWIDGET
+//#  define QT_NO_PRINTPREVIEWWIDGET
+//#endif
+//#ifndef QT_NO_MDIAREA
+//#  define QT_NO_MDIAREA
+//#endif
+//#ifndef QT_NO_TEXTEDIT
+//#  define QT_NO_TEXTEDIT
+//#endif
+//#ifndef QT_NO_SYNTAXHIGHLIGHTER
+//#  define QT_NO_SYNTAXHIGHLIGHTER
+//#endif
+//#ifndef QT_NO_TEXTBROWSER
+//#  define QT_NO_TEXTBROWSER
+//#endif
+//#ifndef QT_NO_SPINWIDGET
+//#  define QT_NO_SPINWIDGET
+//#endif
+//#ifndef QT_NO_SPLASHSCREEN
+//#  define QT_NO_SPLASHSCREEN
+//#endif
+//#ifndef QT_NO_STACKEDWIDGET
+//#  define QT_NO_STACKEDWIDGET
+//#endif
+//#ifndef QT_NO_TABWIDGET
+//#  define QT_NO_TABWIDGET
+//#endif
+//#ifndef QT_NO_STATUSBAR
+//#  define QT_NO_STATUSBAR
+//#endif
+//#ifndef QT_NO_STATUSTIP
+//#  define QT_NO_STATUSTIP
+//#endif
+//#ifndef QT_NO_TABLEWIDGET
+//#  define QT_NO_TABLEWIDGET
+//#endif
+//#ifndef QT_NO_TOOLBUTTON
+//#  define QT_NO_TOOLBUTTON
+//#endif
+//#ifndef QT_NO_TABBAR
+//#  define QT_NO_TABBAR
+//#endif
+//#ifndef QT_NO_TOOLBOX
+//#  define QT_NO_TOOLBOX
+//#endif
+//#ifndef QT_NO_WHATSTHIS
+//#  define QT_NO_WHATSTHIS
+//#endif
+//#ifndef QT_NO_TOOLTIP
+//#  define QT_NO_TOOLTIP
+//#endif
+//#ifndef QT_NO_TREEWIDGET
+//#  define QT_NO_TREEWIDGET
+//#endif
+//#ifndef QT_NO_VALIDATOR
+//#  define QT_NO_VALIDATOR
+//#endif
diff --git a/qtdeclarative/tools/tools.pro b/qtdeclarative/tools/tools.pro
index 18bfe28..ba3e5d4 100644
--- a/qtdeclarative/tools/tools.pro
+++ b/qtdeclarative/tools/tools.pro
@@ -16,9 +16,7 @@ qmlimportscanner.CONFIG = host_build
     qtHaveModule(quick) {
         !static: {
             SUBDIRS += \
-                qmlscene \
-                qmlplugindump \
-                qmltime
+                qmlscene
         }
         qtHaveModule(widgets): SUBDIRS += qmleasing
     }
