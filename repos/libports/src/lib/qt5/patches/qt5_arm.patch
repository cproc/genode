qt5_arm.patch

From: Christian Prochaska <christian.prochaska@genode-labs.com>


---
 .../Source/JavaScriptCore/assembler/ARMAssembler.h |    7 +++++++
 .../JavaScriptCore/assembler/MacroAssemblerARM.cpp |    3 ++-
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/qtwebkit/Source/JavaScriptCore/assembler/ARMAssembler.h b/qtwebkit/Source/JavaScriptCore/assembler/ARMAssembler.h
index c950e47..a21d942 100644
--- a/qtwebkit/Source/JavaScriptCore/assembler/ARMAssembler.h
+++ b/qtwebkit/Source/JavaScriptCore/assembler/ARMAssembler.h
@@ -29,9 +29,14 @@
 
 #if ENABLE(ASSEMBLER) && CPU(ARM_TRADITIONAL)
 
+#if OS(GENODE)
+#include <cpu/cache.h>
+#endif
+
 #include "AssemblerBufferWithConstantPool.h"
 #include "JITCompilationEffort.h"
 #include <wtf/Assertions.h>
+
 namespace JSC {
 
     typedef uint32_t ARMWord;
@@ -1069,6 +1074,8 @@ namespace JSC {
             UNUSED_PARAM(size);
 #elif OS(QNX)
             msync(code, size, MS_INVALIDATE_ICACHE);
+#elif OS(GENODE)
+            Genode::cache_coherent((Genode::addr_t)code, size);
 #else
 #error "The cacheFlush support is missing on this platform."
 #endif
diff --git a/qtwebkit/Source/JavaScriptCore/assembler/MacroAssemblerARM.cpp b/qtwebkit/Source/JavaScriptCore/assembler/MacroAssemblerARM.cpp
index 8f5a148..3b75630 100644
--- a/qtwebkit/Source/JavaScriptCore/assembler/MacroAssemblerARM.cpp
+++ b/qtwebkit/Source/JavaScriptCore/assembler/MacroAssemblerARM.cpp
@@ -69,7 +69,8 @@ static bool isVFPPresent()
     }
 #endif
 
-#if (COMPILER(RVCT) && defined(__TARGET_FPU_VFP)) || (COMPILER(GCC) && defined(__VFP_FP__))
+#if (COMPILER(RVCT) && defined(__TARGET_FPU_VFP)) || \
+    (COMPILER(GCC) && defined(__VFP_FP__) && !defined(__SOFTFP__))
     return true;
 #else
     return false;
