qtwebkit_configuration.patch

From: Christian Prochaska <christian.prochaska@genode-labs.com>


---
 .gitmodules                                        |    4 ++++
 .../Tools/qmake/mkspecs/features/configure.prf     |    1 -
 qtwebkit/Tools/qmake/mkspecs/features/features.prf |   22 ++++++++++----------
 qtwebkit/Tools/qmake/mkspecs/features/features.pri |    2 +-
 qtwebkit/include/QtWebKit/headers.pri              |    4 ++--
 qtwebkit/include/QtWebKitWidgets/headers.pri       |    4 ++--
 6 files changed, 20 insertions(+), 17 deletions(-)

diff --git a/.gitmodules b/.gitmodules
index 5fb4d64e8b..1d9ffee902 100644
--- a/.gitmodules
+++ b/.gitmodules
@@ -302,3 +302,7 @@
 	url = ../qtwebglplugin.git
 	branch = 5.11.3
 	status = preview
+[submodule "qtwebkit"]
+	depends = qtbase
+	path = qtwebkit
+	project = WebKit.pro
diff --git a/qtwebkit/Tools/qmake/mkspecs/features/configure.prf b/qtwebkit/Tools/qmake/mkspecs/features/configure.prf
index 23d99040b6..6ea194fc1f 100644
--- a/qtwebkit/Tools/qmake/mkspecs/features/configure.prf
+++ b/qtwebkit/Tools/qmake/mkspecs/features/configure.prf
@@ -49,7 +49,6 @@ defineTest(runConfigure) {
 
     WEBKIT_CONFIG += \
         build_webkit1 \
-        build_webkit2 \
         build_tests \
         $$WEBKIT_TOOLS_CONFIG
 
diff --git a/qtwebkit/Tools/qmake/mkspecs/features/features.prf b/qtwebkit/Tools/qmake/mkspecs/features/features.prf
index 328a8be7e7..096d8ef679 100644
--- a/qtwebkit/Tools/qmake/mkspecs/features/features.prf
+++ b/qtwebkit/Tools/qmake/mkspecs/features/features.prf
@@ -37,14 +37,14 @@ defineTest(detectFeatures) {
     qtHaveModule(printsupport): WEBKIT_CONFIG += have_qtprintsupport
     qtHaveModule(widgets): WEBKIT_CONFIG += have_qstyle
     qtHaveModule(testlib): WEBKIT_CONFIG += have_qttestlib
-    qtHaveModule(positioning): WEBKIT_CONFIG += have_qtpositioning
-    qtHaveModule(sensors): WEBKIT_CONFIG += have_qtsensors
+    #qtHaveModule(positioning): WEBKIT_CONFIG += have_qtpositioning
+    #qtHaveModule(sensors): WEBKIT_CONFIG += have_qtsensors
 
-    config_libxml2: WEBKIT_CONFIG += use_libxml2
-    config_libxslt: WEBKIT_CONFIG += xslt
-    config_libzlib: WEBKIT_CONFIG += use_zlib
-    config_libwebp: WEBKIT_CONFIG += use_webp
-    config_leveldb: WEBKIT_CONFIG += use_system_leveldb
+    #config_libxml2: WEBKIT_CONFIG += use_libxml2
+    #config_libxslt: WEBKIT_CONFIG += xslt
+    #config_libzlib: WEBKIT_CONFIG += use_zlib
+    #config_libwebp: WEBKIT_CONFIG += use_webp
+    #config_leveldb: WEBKIT_CONFIG += use_system_leveldb
 
     # We can't use Qt's 3rdparty sources for libjpeg and libpng outside of qtbase, but if Qt
     # is using the system libraries, use them to take advantage of the WebCore image decoders as well.
@@ -109,9 +109,9 @@ defineTest(detectFeatures) {
         use?(gstreamer): WEBKIT_CONFIG += use_native_fullscreen_video
     }
 
-    !enable?(video):qtHaveModule(multimediawidgets) {
-        WEBKIT_CONFIG += video use_qt_multimedia
-    }
+    #!enable?(video):qtHaveModule(multimediawidgets) {
+    #    WEBKIT_CONFIG += video use_qt_multimedia
+    #}
 
     !enable?(video) {
         CONFIGURE_WARNINGS += "Missing GStreamer or QtMultimedia, disabling HTML5 media element support"
@@ -126,7 +126,7 @@ defineTest(detectFeatures) {
     }
 
     # Gamepad API Support (depends on udev and linux/joystick.h)
-    linux:!android: WEBKIT_CONFIG += gamepad
+    #linux:!android: WEBKIT_CONFIG += gamepad
 
     # Support for Graphics Surface
     # GraphicsSurface requires GraphicsContext3D and hence use_3d_graphics
diff --git a/qtwebkit/Tools/qmake/mkspecs/features/features.pri b/qtwebkit/Tools/qmake/mkspecs/features/features.pri
index ba18b354d4..dd27a421ca 100644
--- a/qtwebkit/Tools/qmake/mkspecs/features/features.pri
+++ b/qtwebkit/Tools/qmake/mkspecs/features/features.pri
@@ -59,7 +59,7 @@ FEATURE_DEFAULTS = \
     ENABLE_HIGH_DPI_CANVAS=0 \
     ENABLE_ICONDATABASE=1 \
     ENABLE_IFRAME_SEAMLESS=1 \
-    ENABLE_INDEXED_DATABASE=1 \
+    ENABLE_INDEXED_DATABASE=0 \
     ENABLE_INPUT_SPEECH=0 \
     ENABLE_INPUT_TYPE_COLOR=1 \
     ENABLE_INPUT_TYPE_DATE=0 \
diff --git a/qtwebkit/include/QtWebKit/headers.pri b/qtwebkit/include/QtWebKit/headers.pri
index 6775f3a6de..8b4aff7af4 100644
--- a/qtwebkit/include/QtWebKit/headers.pri
+++ b/qtwebkit/include/QtWebKit/headers.pri
@@ -1,5 +1,5 @@
-SYNCQT.HEADER_FILES = WebKit/qt/Api/qwebdatabase.h WebKit/qt/Api/qwebelement.h WebKit/qt/Api/qwebhistory.h WebKit/qt/Api/qwebhistoryinterface.h WebKit/qt/Api/qwebkitglobal.h WebKit/qt/Api/qwebkitplatformplugin.h WebKit/qt/Api/qwebpluginfactory.h WebKit/qt/Api/qwebsecurityorigin.h WebKit/qt/Api/qwebsettings.h ../include/QtWebKit/qtwebkitversion.h ../include/QtWebKit/QtWebKit 
-SYNCQT.HEADER_CLASSES = ../include/QtWebKit/QWebDatabase ../include/QtWebKit/QWebElement ../include/QtWebKit/QWebElementCollection ../include/QtWebKit/QWebHistoryItem ../include/QtWebKit/QWebHistory ../include/QtWebKit/QWebHistoryInterface ../include/QtWebKit/QWebSelectData ../include/QtWebKit/QWebSelectMethod ../include/QtWebKit/QWebNotificationData ../include/QtWebKit/QWebNotificationPresenter ../include/QtWebKit/QWebHapticFeedbackPlayer ../include/QtWebKit/QWebTouchModifier ../include/QtWebKit/QWebFullScreenVideoHandler ../include/QtWebKit/QWebSpellChecker ../include/QtWebKit/QWebKitPlatformPlugin ../include/QtWebKit/QWebPluginFactory ../include/QtWebKit/QWebSecurityOrigin ../include/QtWebKit/QWebSettings ../include/QtWebKit/QtWebKitVersion 
+SYNCQT.HEADER_FILES = WebKit/qt/Api/qwebdatabase.h WebKit/qt/Api/qwebelement.h WebKit/qt/Api/qwebhistory.h WebKit/qt/Api/qwebhistoryinterface.h WebKit/qt/Api/qwebkitglobal.h WebKit/qt/Api/qwebkitplatformplugin.h WebKit/qt/Api/qwebpluginfactory.h WebKit/qt/Api/qwebsecurityorigin.h WebKit/qt/Api/qwebsettings.h qtwebkitversion.h QtWebKit 
+SYNCQT.GENERATED_HEADER_FILES = QWebDatabase QWebElement QWebElementCollection QWebHistoryItem QWebHistory QWebHistoryInterface QWebSelectData QWebSelectMethod QWebNotificationData QWebNotificationPresenter QWebHapticFeedbackPlayer QWebTouchModifier QWebFullScreenVideoHandler QWebSpellChecker QWebKitPlatformPlugin QWebPluginFactory QWebSecurityOrigin QWebSettings QtWebKitVersion 
 SYNCQT.PRIVATE_HEADER_FILES = WebKit/qt/Api/qhttpheader_p.h WebKit/qt/Api/qwebdatabase_p.h WebKit/qt/Api/qwebelement_p.h WebKit/qt/Api/qwebhistory_p.h WebKit/qt/Api/qwebplugindatabase_p.h WebKit/qt/Api/qwebscriptworld.h WebKit/qt/Api/qwebscriptworld_p.h WebKit/qt/Api/qwebsecurityorigin_p.h WebKit2/UIProcess/API/qt/qquicknetworkreply_p.h WebKit2/UIProcess/API/qt/qquicknetworkrequest_p.h WebKit2/UIProcess/API/qt/qquickurlschemedelegate_p.h WebKit2/UIProcess/API/qt/qquickwebpage_p.h WebKit2/UIProcess/API/qt/qquickwebpage_p_p.h WebKit2/UIProcess/API/qt/qquickwebview_p.h WebKit2/UIProcess/API/qt/qquickwebview_p_p.h WebKit2/UIProcess/API/qt/qtwebsecurityorigin_p.h WebKit2/UIProcess/API/qt/qwebchannelwebkittransport_p.h WebKit2/UIProcess/API/qt/qwebdownloaditem_p.h WebKit2/UIProcess/API/qt/qwebdownloaditem_p_p.h WebKit2/UIProcess/API/qt/qwebiconimageprovider_p.h WebKit2/UIProcess/API/qt/qwebkittest_p.h WebKit2/UIProcess/API/qt/qwebloadrequest_p.h WebKit2/UIProcess/API/qt/qwebnavigationhistory_p.h WebKit2/UIProcess/API/qt/qwebnavigationhistory_p_p.h WebKit2/UIProcess/API/qt/qwebnavigationrequest_p.h WebKit2/UIProcess/API/qt/qwebpermissionrequest_p.h WebKit2/UIProcess/API/qt/qwebpreferences_p.h WebKit2/UIProcess/API/qt/qwebpreferences_p_p.h WebKit2/UIProcess/API/qt/raw/qrawwebview_p.h WebKit2/UIProcess/API/qt/raw/qrawwebview_p_p.h WebKit2/UIProcess/API/qt/tests/bytearraytestdata.h WebKit2/UIProcess/API/qt/tests/testwindow.h WebKit2/UIProcess/API/qt/tests/util.h 
 SYNCQT.INJECTED_PRIVATE_HEADER_FILES = 
 SYNCQT.QPA_HEADER_FILES = 
diff --git a/qtwebkit/include/QtWebKitWidgets/headers.pri b/qtwebkit/include/QtWebKitWidgets/headers.pri
index 9d386e29b6..8d11b7909a 100644
--- a/qtwebkit/include/QtWebKitWidgets/headers.pri
+++ b/qtwebkit/include/QtWebKitWidgets/headers.pri
@@ -1,5 +1,5 @@
-SYNCQT.HEADER_FILES = WebKit/qt/WidgetApi/qgraphicswebview.h WebKit/qt/WidgetApi/qwebframe.h WebKit/qt/WidgetApi/qwebinspector.h WebKit/qt/WidgetApi/qwebpage.h WebKit/qt/WidgetApi/qwebview.h ../include/QtWebKitWidgets/qtwebkitwidgetsversion.h ../include/QtWebKitWidgets/QtWebKitWidgets 
-SYNCQT.HEADER_CLASSES = ../include/QtWebKitWidgets/QGraphicsWebView ../include/QtWebKitWidgets/QWebHitTestResult ../include/QtWebKitWidgets/QWebFrame ../include/QtWebKitWidgets/QWebInspector ../include/QtWebKitWidgets/QWebPage ../include/QtWebKitWidgets/QWebView ../include/QtWebKitWidgets/QtWebKitWidgetsVersion 
+SYNCQT.HEADER_FILES = WebKit/qt/WidgetApi/qgraphicswebview.h WebKit/qt/WidgetApi/qwebframe.h WebKit/qt/WidgetApi/qwebinspector.h WebKit/qt/WidgetApi/qwebpage.h WebKit/qt/WidgetApi/qwebview.h qtwebkitwidgetsversion.h QtWebKitWidgets 
+SYNCQT.GENERATED_HEADER_FILES = QGraphicsWebView QWebHitTestResult QWebFrame QWebInspector QWebPage QWebView QtWebKitWidgetsVersion 
 SYNCQT.PRIVATE_HEADER_FILES = WebKit/qt/WidgetApi/qwebframe_p.h WebKit/qt/WidgetApi/qwebinspector_p.h WebKit/qt/WidgetApi/qwebpage_p.h WebKit/qt/WidgetApi/qwebviewaccessible_p.h 
 SYNCQT.INJECTED_PRIVATE_HEADER_FILES = 
 SYNCQT.QPA_HEADER_FILES = 
