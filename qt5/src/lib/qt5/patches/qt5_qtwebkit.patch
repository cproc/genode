qt5_qtwebkit.patch

From: Christian Prochaska <christian.prochaska@genode-labs.com>


---
 .../Source/JavaScriptCore/dfg/DFGOperations.cpp    |    6 ++++++
 qtwebkit/Source/WTF/wtf/Platform.h                 |   13 +++++++++++++
 .../Source/WebCore/editing/MarkupAccumulator.cpp   |    5 +++++
 3 files changed, 24 insertions(+)

diff --git a/qtwebkit/Source/JavaScriptCore/dfg/DFGOperations.cpp b/qtwebkit/Source/JavaScriptCore/dfg/DFGOperations.cpp
index ad595ae..f27948e 100644
--- a/qtwebkit/Source/JavaScriptCore/dfg/DFGOperations.cpp
+++ b/qtwebkit/Source/JavaScriptCore/dfg/DFGOperations.cpp
@@ -1567,7 +1567,9 @@ namespace JSC {
 #if COMPILER(GCC) && CPU(X86_64)
 asm (
 ".globl " SYMBOL_STRING(getHostCallReturnValue) "\n"
+#if !OS(GENODE)
 HIDE_SYMBOL(getHostCallReturnValue) "\n"
+#endif /* OS(GENODE) */
 SYMBOL_STRING(getHostCallReturnValue) ":" "\n"
     "mov -40(%r13), %r13\n"
     "mov %r13, %rdi\n"
@@ -1577,7 +1579,9 @@ SYMBOL_STRING(getHostCallReturnValue) ":" "\n"
 asm (
 ".text" "\n" \
 ".globl " SYMBOL_STRING(getHostCallReturnValue) "\n"
+#if !OS(GENODE)
 HIDE_SYMBOL(getHostCallReturnValue) "\n"
+#endif /* OS(GENODE) */
 SYMBOL_STRING(getHostCallReturnValue) ":" "\n"
     "mov -40(%edi), %edi\n"
     "mov %edi, 4(%esp)\n"
@@ -1600,7 +1604,9 @@ SYMBOL_STRING(getHostCallReturnValue) ":" "\n"
 asm (
 ".text" "\n"
 ".globl " SYMBOL_STRING(getHostCallReturnValue) "\n"
+#if !OS(GENODE)
 HIDE_SYMBOL(getHostCallReturnValue) "\n"
+#endif /* OS(GENODE) */
 INLINE_ARM_FUNCTION(getHostCallReturnValue)
 SYMBOL_STRING(getHostCallReturnValue) ":" "\n"
     "ldr r5, [r5, #-40]" "\n"
diff --git a/qtwebkit/Source/WTF/wtf/Platform.h b/qtwebkit/Source/WTF/wtf/Platform.h
index 1603019..f482551 100644
--- a/qtwebkit/Source/WTF/wtf/Platform.h
+++ b/qtwebkit/Source/WTF/wtf/Platform.h
@@ -153,6 +153,7 @@
     || defined(_M_IX86)  \
     || defined(_X86_)    \
     || defined(__THW_INTEL)
+l
 #define WTF_CPU_X86 1
 #endif
 
@@ -426,6 +427,13 @@
 #define WTF_OS_UNIX 1
 #endif
 
+/* OS(GENODE) */
+/* Operating system level dependencies for Genode that should */
+/* be used regardless of operating environment */
+#ifdef __GENODE__
+#define WTF_OS_GENODE 1
+#endif
+
 /* Operating environments */
 
 /* FIXME: these are all mixes of OS, operating environment and policy choices. */
@@ -892,6 +900,11 @@
 #define ENABLE_JIT 1
 #endif
 
+/* Disable LLINT for Genode */
+#if OS(GENODE)
+#define ENABLE_LLINT 0
+#endif
+
 /* The JIT is enabled by default on all x86, x86-64, ARM & MIPS platforms. */
 #if !defined(ENABLE_JIT) \
     && (CPU(X86) || CPU(X86_64) || CPU(ARM) || CPU(MIPS)) \
diff --git a/qtwebkit/Source/WebCore/editing/MarkupAccumulator.cpp b/qtwebkit/Source/WebCore/editing/MarkupAccumulator.cpp
index beb832f..e348a73 100644
--- a/qtwebkit/Source/WebCore/editing/MarkupAccumulator.cpp
+++ b/qtwebkit/Source/WebCore/editing/MarkupAccumulator.cpp
@@ -28,7 +28,12 @@
 #include "MarkupAccumulator.h"
 
 #include "CDATASection.h"
+#if OS(GENODE)
+/* resolve ambiguity with JavaScriptCore header file */
+#include "dom/Comment.h"
+#else
 #include "Comment.h"
+#endif /* OS(GENODE) */
 #include "DocumentFragment.h"
 #include "DocumentType.h"
 #include "Editor.h"
